<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cam test</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#000;overflow:hidden;height:100vh;position:fixed;width:100vw}
        #video{width:100vw;height:100vh;object-fit:cover;display:none}
        .placeholder{width:100vw;height:100vh;background:#222;display:flex;align-items:center;justify-content:center;color:#fff;font-size:18px;text-align:center;flex-direction:column}
        .ui{position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:10}
        .top-bar{position:absolute;top:0;left:0;right:0;padding:env(safe-area-inset-top,20px) 20px 20px;background:linear-gradient(180deg,rgba(0,0,0,0.7) 0%,transparent 100%);display:flex;justify-content:space-between;align-items:center;pointer-events:auto}
        .bottom-bar{position:absolute;bottom:0;left:0;right:0;padding:30px 20px calc(env(safe-area-inset-bottom,20px) + 20px);background:linear-gradient(0deg,rgba(0,0,0,0.7) 0%,transparent 100%);pointer-events:auto}
        .effects{display:flex;gap:10px;overflow-x:auto;padding:10px 0;margin-bottom:20px;-webkit-overflow-scrolling:touch}
        .effects::-webkit-scrollbar{display:none}
        .effect{min-width:50px;height:50px;border-radius:25px;background:rgba(255,255,255,0.2);border:2px solid transparent;color:#fff;font-size:16px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s ease;flex-shrink:0;backdrop-filter:blur(10px)}
        .effect.active{background:rgba(255,255,255,0.4);border-color:rgba(255,255,255,0.8);transform:scale(1.1)}
        .controls{display:flex;justify-content:space-between;align-items:center}
        .btn{width:50px;height:50px;border-radius:25px;background:rgba(255,255,255,0.2);border:none;color:#fff;font-size:18px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s ease;backdrop-filter:blur(10px)}
        .btn:hover{background:rgba(255,255,255,0.3)}
        .btn:disabled{opacity:0.5;cursor:not-allowed}
        .capture{width:70px;height:70px;border-radius:35px;background:#fff;color:#000;font-size:24px}
        .capture:disabled{background:rgba(255,255,255,0.3);color:#666}
        .status{position:absolute;top:calc(env(safe-area-inset-top,20px) + 80px);left:20px;right:20px;text-align:center;color:#fff;font-size:14px;background:rgba(0,0,0,0.7);padding:10px 16px;border-radius:20px;transform:translateY(-100px);opacity:0;transition:all 0.3s ease;pointer-events:none}
        .status.show{transform:translateY(0);opacity:1}
        .flash{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#fff;opacity:0;pointer-events:none;z-index:15}
        
        .vintage{filter:sepia(0.7) contrast(1.2) brightness(1.1)}
        .noir{filter:grayscale(1) contrast(1.5)}
        .warm{filter:hue-rotate(15deg) saturate(1.3) brightness(1.1)}
        .cool{filter:hue-rotate(240deg) saturate(1.2)}
        .vivid{filter:saturate(1.8) contrast(1.2)}
        .soft{filter:blur(0.3px) brightness(1.15)}
        .retro{filter:sepia(0.5) hue-rotate(20deg) saturate(1.5)}
        .neon{filter:hue-rotate(270deg) saturate(2) contrast(1.3)}
    </style>
</head>
<body>
    <div id="placeholder" class="placeholder">
        <div>Cam By Ardy Hutasoit</div>
        <div style="font-size:14px;margin-top:10px;opacity:0.7">Tap Start to begin</div>
    </div>
    
    <video id="video" autoplay playsinline muted></video>
    <div id="flash" class="flash"></div>
    
    <div class="ui">
        <div class="top-bar">
            <div style="color:#fff;font-size:14px" id="info">Cam Tester</div>
            <button class="btn" id="switchBtn">🔄</button>
        </div>

        <div id="status" class="status">Ready</div>

        <div class="bottom-bar">
            <div class="effects">
                <div class="effect active" data-effect="">📷</div>
                <div class="effect" data-effect="vintage">📸</div>
                <div class="effect" data-effect="noir">⚫</div>
                <div class="effect" data-effect="warm">🔥</div>
                <div class="effect" data-effect="cool">❄️</div>
                <div class="effect" data-effect="vivid">🌈</div>
                <div class="effect" data-effect="soft">☁️</div>
                <div class="effect" data-effect="retro">🌅</div>
                <div class="effect" data-effect="neon">💜</div>
            </div>
            
            <div class="controls">
                <button class="btn" id="startBtn">▶️</button>
                <button class="btn capture" id="captureBtn" disabled>📸</button>
                <button class="btn" id="stopBtn" disabled>⏹️</button>
            </div>
        </div>
    </div>

    <script>
        class Camera {
            constructor() {
                this.video = document.getElementById('video');
                this.placeholder = document.getElementById('placeholder');
                this.startBtn = document.getElementById('startBtn');
                this.captureBtn = document.getElementById('captureBtn');
                this.stopBtn = document.getElementById('stopBtn');
                this.switchBtn = document.getElementById('switchBtn');
                this.status = document.getElementById('status');
                this.info = document.getElementById('info');
                this.flash = document.getElementById('flash');
                
                this.stream = null;
                this.facingMode = 'environment'; // back camera
                this.currentEffect = '';
                
                this.init();
            }
            
            init() {
                // Event listeners
                this.startBtn.addEventListener('click', () => this.start());
                this.captureBtn.addEventListener('click', () => this.capture());
                this.stopBtn.addEventListener('click', () => this.stop());
                this.switchBtn.addEventListener('click', () => this.switch());
                
                // Effects
                document.querySelectorAll('.effect').forEach(btn => {
                    btn.addEventListener('click', () => this.setEffect(btn));
                });
                
                this.showStatus('Tekan ▶️ Untuk Memulai');
            }
            
            async start() {
                try {
                    this.showStatus('Starting camera...');
                    
                    const constraints = {
                        video: {
                            facingMode: this.facingMode,
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        }
                    };
                    
                    this.stream = await navigator.mediaDevices.getUserMedia(constraints);
                    this.video.srcObject = this.stream;
                    
                    // Wait for video to be ready
                    this.video.onloadedmetadata = () => {
                        this.video.play();
                        this.placeholder.style.display = 'none';
                        this.video.style.display = 'block';
                        
                        this.startBtn.disabled = true;
                        this.captureBtn.disabled = false;
                        this.stopBtn.disabled = false;
                        
                        this.info.textContent = this.facingMode === 'user' ? 'Front Camera' : 'Back Camera';
                        this.showStatus('Camera active! 📹');
                    };
                    
                } catch (error) {
                    console.error('Camera error:', error);
                    
                    let message = 'Camera failed: ';
                    if (error.name === 'NotAllowedError') {
                        message += 'Permission denied';
                    } else if (error.name === 'NotFoundError') {
                        message += 'No camera found';
                    } else if (error.name === 'NotReadableError') {
                        message += 'Camera busy';
                    } else {
                        message += error.message;
                    }
                    
                    this.showStatus(message);
                }
            }
            
            async switch() {
                if (!this.stream) return;
                
                this.showStatus('Switching camera...');
                this.facingMode = this.facingMode === 'user' ? 'environment' : 'user';
                
                await this.stop();
                setTimeout(() => this.start(), 500);
            }
            
            capture() {
                if (!this.stream) return;
                
                // Flash effect
                this.flash.style.opacity = '0.8';
                setTimeout(() => {
                    this.flash.style.opacity = '0';
                }, 100);
                
                // Create canvas for capture
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = this.video.videoWidth;
                canvas.height = this.video.videoHeight;
                
                // Apply effect to canvas
                if (this.currentEffect) {
                    ctx.filter = this.getFilter(this.currentEffect);
                }
                
                ctx.drawImage(this.video, 0, 0);
                
                // Download photo
                canvas.toBlob(blob => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `photo_${Date.now()}.jpg`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showStatus('Photo saved! 💾');
                }, 'image/jpeg', 0.9);
            }
            
            stop() {
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                    this.stream = null;
                }
                
                this.video.srcObject = null;
                this.video.style.display = 'none';
                this.placeholder.style.display = 'flex';
                
                this.startBtn.disabled = false;
                this.captureBtn.disabled = true;
                this.stopBtn.disabled = true;
                
                this.info.textContent = 'Camera Stopped';
                this.showStatus('Camera stopped');
            }
            
            setEffect(btn) {
                document.querySelectorAll('.effect').forEach(e => e.classList.remove('active'));
                btn.classList.add('active');
                
                this.currentEffect = btn.dataset.effect;
                this.video.className = this.currentEffect;
                
                const effectName = this.currentEffect || 'Normal';
                this.showStatus(effectName.charAt(0).toUpperCase() + effectName.slice(1));
            }
            
            getFilter(effect) {
                const filters = {
                    vintage: 'sepia(0.7) contrast(1.2) brightness(1.1)',
                    noir: 'grayscale(1) contrast(1.5)',
                    warm: 'hue-rotate(15deg) saturate(1.3) brightness(1.1)',
                    cool: 'hue-rotate(240deg) saturate(1.2)',
                    vivid: 'saturate(1.8) contrast(1.2)',
                    soft: 'blur(0.3px) brightness(1.15)',
                    retro: 'sepia(0.5) hue-rotate(20deg) saturate(1.5)',
                    neon: 'hue-rotate(270deg) saturate(2) contrast(1.3)'
                };
                return filters[effect] || 'none';
            }
            
            showStatus(message) {
                this.status.textContent = message;
                this.status.classList.add('show');
                setTimeout(() => {
                    this.status.classList.remove('show');
                }, 2000);
            }
        }
        
        // Check support
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            new Camera();
        } else {
            document.body.innerHTML = `
                <div style="display:flex;align-items:center;justify-content:center;height:100vh;color:white;text-align:center;padding:20px">
                    <div>
                        <h1>❌ Not Supported</h1>
                        <p>Please use Chrome, Safari, or Firefox on mobile</p>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>